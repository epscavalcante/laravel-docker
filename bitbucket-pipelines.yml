image: php:8.1.18-fpm-alpine3.18

definitions:
  services:
    db:
      image: mysql:8.0.33
      environment:
        MYSQL_DATABASE: 'app'
        MYSQL_ROOT_PASSWORD: 'root'
        memory: '256'

pipelines:
  default:
    - step:
        script: # Modify the commands below to build your repository.
          - apk add openssl
          - docker-php-ext-install-pdo pdo_mysql
          - apt-get update && apt-get install -y unzip
          - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
          - composer -V
          - php -r "file_exists('.env') || copy('.env.example', '.env');"
          - composer install
          - php artisan key:generate
          - php artisan test
          - php artisan migrate:fresh --force
          - ./vendor/bin/pint